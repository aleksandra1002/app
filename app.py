import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.express as px

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ Titanic
@st.cache_data  # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
def load_data():
    # –∫–∞—á–∞—é —Ç–∞–±–ª–∏—á–∫—É
    url = "https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv"
    
    # –≤–æ–∑–≤—Ä–∞—â–∞—é –¥–∞—Ç–∞—Å–µ—Ç
    return pd.read_csv(url)

df = load_data()


# —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—á–∫–∏
page = st.sidebar.selectbox("–í—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É", 
                            ["–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ",
                             "–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", 
                             "–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤",
                             "–ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤—ã–∂–∏–≤—à–∏—Ö",
                             "–í–æ–∑—Ä–∞—Å—Ç vs –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞",
                             "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å—É –±–∏–ª–µ—Ç–∞",
                             "–í–æ–∑—Ä–∞—Å—Ç –ø–æ –∫–ª–∞—Å—Å–∞–º –±–∏–ª–µ—Ç–∞",
                             "–í—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã",
                             "–ü–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å"])


if page == "–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ":
    st.title("–î–∞—à–±–æ–∞—Ä–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –¢–∏—Ç–∞–Ω–∏–∫–∞ üö¢")

    st.image(
        'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/b5229bb5-6ca7-41f8-8e49-59bd2a0f4737/dh8iilh-c9cf1533-4888-4c0f-b6c6-f608bc26cda8.jpg/v1/fill/w_1213,h_659,q_70,strp/on_this_night__112_years_ago__the_titanic_sank__by_robloxfan333172_dh8iilh-pre.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTA4NiIsInBhdGgiOiJcL2ZcL2I1MjI5YmI1LTZjYTctNDFmOC04ZTQ5LTU5YmQyYTBmNDczN1wvZGg4aWlsaC1jOWNmMTUzMy00ODg4LTRjMGYtYjZjNi1mNjA4YmMyNmNkYTguanBnIiwid2lkdGgiOiI8PTIwMDAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.4C9QHAOryXN_Jv43Q6G-6y7hOZgPP7XU8SSs-d_zpRg', 
         caption = '',
         use_container_width=True
    )


# –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
elif page == "–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞":
    st.title("–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ üìà")
    st.write("–§–æ—Ä–º–∞ —Ç–∞–±–ª–∏—Ü—ã:", df.shape)
    st.write("–ö–æ–ª–æ–Ω–∫–∏ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:")
    # –º–µ—Ç–æ–¥ Pandas, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞:
    st.write(df.dtypes)
    st.subheader('üëÜ DataFrame –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –≤ –∫–∞–∫–æ–π –∫–æ–ª–æ–Ω–∫–µ –∫–∞–∫–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö')

elif page == "–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤":
    st.title("–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ üìä")
    fig1, ax1 = plt.subplots()

    # –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ seaborn –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã:
    # —É–¥–∞–ª—è—é –ø—Ä–æ–ø—É—Å–∫–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞, kde=True - –≥–ª–∞–¥–∫–∞—è –ø—Ä—è–º–∞—è —Å–≤–µ—Ä—Ö—É –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
    sns.histplot(df['Age'].dropna(), kde=True, ax=ax1)
    # —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è matplotlib-–≥—Ä–∞—Ñ–∏–∫–æ–≤
    st.pyplot(fig1)

    st.subheader('–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ üë®üèª‚Äçü¶≥')

elif page == "–ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤—ã–∂–∏–≤—à–∏—Ö":

    st.title("–ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –≤—ã–∂–∏–≤—à–∏—Ö")

    # –ø–æ–¥—Å—á—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ —Å –≤—ã–∂–∏–≤—à–∏–º–∏
    survived_counts = df['Survived'].value_counts()

    # –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å 

    # –Ω–∞–¥–ø–∏—Å—å
    st.header("–ù–∞—Å—Ç—Ä–æ–π–∫a —Ü–≤–µ—Ç–æ–≤")
    st.subheader('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã üëá')
    # –≤—ã–±–æ—Ä –¥–ª—è –Ω–µ –≤—ã–∂–∏–≤—à–∏—Ö —Å –ø–æ–º–æ—â—å—é color_picker()
    color_not_survived = st.color_picker(
        "–¶–≤–µ—Ç –¥–ª—è '–ù–µ –≤—ã–∂–∏–ª–∏'", 
        "#ff9999"  # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π)
    )

    # –≤—ã–±–æ—Ä –¥–ª—è –≤—ã–∂–∏–≤—à–∏—Ö —Å –ø–æ–º–æ—â—å—é color_picker()
    color_survived = st.color_picker(
        "–¶–≤–µ—Ç –¥–ª—è '–í—ã–∂–∏–ª–∏'", 
        "#66b3ff"  # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π)
    )

    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏
    fig2, ax2 = plt.subplots()
    ax2.pie(
        survived_counts,
        labels=['–ù–µ –≤—ã–∂–∏–ª–∏', '–í—ã–∂–∏–ª–∏'],
        autopct='%1.1f%%',
        colors=[color_not_survived, color_survived],
    )
    # –≤—ã–≤–æ–∂—É
    st.pyplot(fig2)
    st.subheader('–î–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—ã–∂–∏–≤—à–∏—Ö –∏ –Ω–µ –≤—ã–∂–∏–≤—à–∏—Ö üö¢')

elif page == "–í–æ–∑—Ä–∞—Å—Ç vs –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞":

    st.title("–í–æ–∑—Ä–∞—Å—Çüë©üèª‚Äçü¶≥ vs –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞üí∞")

    # —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–µ—á–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ px.scatter
    # color='Survived' - —Ä–∞—Å–∫—Ä–∞—Å–∫–∞ –ø–æ –≤—ã–∂–∏–≤–∞–Ω–∏—é
    fig3 = px.scatter(df, x='Age', y='Fare', color='Survived', title="–í–æ–∑—Ä–∞—Å—Ç vs –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞")
    st.plotly_chart(fig3)
    st.subheader('–¢–æ—á–µ—á–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–∞ üë±üèª‚Äç‚ôÇÔ∏è')
    st.subheader('–ù–µ –≤—ã–∂–∏–≤—à–∏–µ - —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–µ —Ç–æ—á–∫–∏, –≤—ã–∂–∏–≤—à–∏–µ - –±–µ–ª—ã–µ')

elif page == "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å—É –±–∏–ª–µ—Ç–∞":

    st.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å—É –±–∏–ª–µ—Ç–∞ üìâ")
    selected_class = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –±–∏–ª–µ—Ç–∞", df['Pclass'].unique())

    # –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
    hist_color = st.color_picker(
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã",
        "#1f77b4"  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–Ω–∏–π Plotly
    )
    filtered_df = df[df['Pclass'] == selected_class]

    # –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –ø–æ –¥–∞–Ω–Ω—ã–º filtered_df —Å 
    fig4 = px.histogram(
        filtered_df, 
        x='Age', 
        title=f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –¥–ª—è –∫–ª–∞—Å—Å–∞ {selected_class}", 
        color_discrete_sequence=[hist_color]
    )
    # –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤ –º–µ–∂–¥—É —Å—Ç–æ–ª–±—Ü–∞–º–∏ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±)
    fig4.update_layout(
        bargap=0.1,  # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç–æ–ª–±—Ü–∞–º–∏ (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Plotly!)
        bargroupgap=0.1,  # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ —Å—Ç–æ–ª–±—Ü–æ–≤
        xaxis_title="–í–æ–∑—Ä–∞—Å—Ç",
        yaxis_title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤"
    )
    # –≤—ã–≤–æ–¥
    st.plotly_chart(fig4)

    # –ø—Ä–∏–∫–æ–ª—å–Ω–∞—è —à—Ç—É—á–∫–∞ —Å –ø–æ–ª–∑—É–Ω–∫–æ–º
    optionals = st.expander("Optional Configurations", True)

    fare_min = optionals.slider(
    "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞",
    min_value=float(df['Fare'].min()),
    max_value=float(df['Fare'].max())
    )
    fare_max = optionals.slider(
    "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞",
    min_value=float(df['Fare'].min()),
    max_value=float(df['Fare'].max())
    )
    subset_fare = df[(df['Fare'] <= fare_max) & (fare_min <= df['Fare'])]

    st.subheader(f"–ß–∏—Å–ª–æ –∑–∞–ø–∏—Å–µ–π –ø–æ —Ü–µ–Ω–µ –±–∏–ª–µ—Ç–∞ –º–µ–∂–¥—É {fare_min} –∏ {fare_max}: {subset_fare.shape[0]}")


elif page == "–í–æ–∑—Ä–∞—Å—Ç –ø–æ –∫–ª–∞—Å—Å–∞–º –±–∏–ª–µ—Ç–∞":

    st.title("–í–æ–∑—Ä–∞—Å—Ç –ø–æ –∫–ª–∞—Å—Å–∞–º –±–∏–ª–µ—Ç–∞ üõ≥Ô∏è")
    fig5, ax5 = plt.subplots()
    sns.boxplot(x='Pclass', y='Age', data=df, ax=ax5)
    st.pyplot(fig5)
    st.subheader('‚¨ÜÔ∏è –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∞—Å—Å—É –±–∏–ª–µ—Ç–∞ –∏ –≤–æ–∑—Ä–∞—Å—Ç—É')

elif page == "–í—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã":

    st.title("–í—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã")
    # –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥ —á–∏—Å–ª–∞ —Å—Ç—Ä–æ–∫
    st.subheader('–ê –≤–æ—Ç –∏ —Å–∞–º–∞ —Ç–∞–±–ª–∏—Ü–∞')
    st.subheader("–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚¨áÔ∏è")
    n_rows = st.number_input('', min_value=1, max_value=len(df), value=5)
    # –ø–µ—á–∞—Ç–∞—Ç –ø–µ—Ä–≤—ã–µ n_rows –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
    st.write(df.head(n_rows))

elif page == "–ü–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å":

    st.title('–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ!!!')
    st.image(
        'https://steamuserimages-a.akamaihd.net/ugc/2056493493099136845/4F5CA933CF2D2C5039DAEE1B15E48F9BE9491888/?imw=512&amp;&amp;ima=fit&amp;impolicy=Letterbox&amp;imcolor=%23000000&amp;letterbox=false', 
         caption = '',
         use_container_width=True
    )